<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargador y Procesador de CSV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Gris claro de Tailwind */
            color: #1f2937; /* Gris oscuro de Tailwind */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: white;
            padding: 2rem; /* 32px */
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 800px; /* Ancho máximo aumentado para tabla */
            margin-top: 2rem;
        }
        h1 {
            font-size: 1.875rem; /* 30px */
            font-weight: 700;
            color: #2563eb; /* Azul de Tailwind */
            margin-bottom: 1.5rem; /* 24px */
            text-align: center;
        }
        label, p {
            font-size: 1rem; /* 16px */
            margin-bottom: 0.5rem;
        }
        input[type="file"] {
            display: block;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border: 1px solid #d1d5db; /* Gris de Tailwind */
            border-radius: 0.375rem; /* 6px */
            width: 100%;
        }
        .button {
            background-color: #3b82f6; /* Azul de Tailwind */
            color: white;
            font-weight: 500;
            padding: 0.75rem 1.5rem; /* 12px 24px */
            border-radius: 0.5rem; /* 8px */
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-top: 0.5rem;
        }
        .button:hover {
            background-color: #2563eb; /* Azul más oscuro de Tailwind */
        }
        .message-box {
            margin-top: 1.5rem; /* 24px */
            padding: 1rem; /* 16px */
            border-radius: 0.5rem; /* 8px */
            border-width: 1px;
            border-style: solid;
        }
        .message-box.success {
            background-color: #d1fae5; /* Verde claro de Tailwind */
            color: #065f46; /* Verde oscuro de Tailwind */
            border-color: #6ee7b7; /* Verde de Tailwind */
        }
        .message-box.error {
            background-color: #fee2e2; /* Rojo claro de Tailwind */
            color: #991b1b; /* Rojo oscuro de Tailwind */
            border-color: #fca5a5; /* Rojo de Tailwind */
        }
        .message-box.info {
            background-color: #dbeafe; /* Azul claro de Tailwind */
            color: #1e40af; /* Azul oscuro de Tailwind */
            border-color: #93c5fd; /* Azul de Tailwind */
        }
        table {
            width: 100%;
            margin-top: 1.5rem;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #e5e7eb; /* Gris de Tailwind */
            padding: 0.75rem; /* 12px */
            text-align: left;
            font-size: 0.875rem; /* 14px */
        }
        th {
            background-color: #f9fafb; /* Gris muy claro de Tailwind */
            font-weight: 600;
        }
        /* Estilo para el mensaje de "arrastra y suelta" */
        #dropZone {
            border: 2px dashed #9ca3af; /* Gris de Tailwind */
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            background-color: #f9fafb;
            transition: background-color 0.2s ease;
        }
        #dropZone.dragover {
            background-color: #e0e7ff; /* Azul muy claro de Tailwind */
            border-color: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cargador de Archivos CSV</h1>

        <div id="dropZone">
            <p>Arrastra y suelta un archivo CSV aquí, o haz clic en el botón de abajo para seleccionarlo.</p>
        </div>

        <input type="file" id="csvFileInput" accept=".csv">
        
        <div id="messageArea" class="message-box info" style="display: none;"></div>
        
        <div id="outputArea">
            <table id="csvDataTable" style="display:none;">
                <thead>
                    <tr id="csvHeaderRow"></tr>
                </thead>
                <tbody id="csvBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Elementos del DOM
        const csvFileInput = document.getElementById('csvFileInput');
        const messageArea = document.getElementById('messageArea');
        const outputArea = document.getElementById('outputArea');
        const csvDataTable = document.getElementById('csvDataTable');
        const csvHeaderRow = document.getElementById('csvHeaderRow');
        const csvBody = document.getElementById('csvBody');
        const dropZone = document.getElementById('dropZone');

        // --- Funcionalidad de Arrastrar y Soltar ---
        dropZone.addEventListener('dragover', (event) => {
            event.preventDefault(); // Prevenir el comportamiento por defecto (abrir el archivo)
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (event) => {
            event.preventDefault();
            dropZone.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.name.endsWith('.csv')) {
                    csvFileInput.files = files; // Asignar el archivo al input para reusar la lógica
                    handleFile(file);
                } else {
                    showMessage('Por favor, suelta un archivo CSV.', 'error');
                }
            }
        });

        // Activar el input de archivo al hacer clic en la zona de drop
        dropZone.addEventListener('click', () => {
            csvFileInput.click();
        });
        
        // --- Manejo del Archivo Seleccionado ---
        csvFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        });

        function handleFile(file) {
            if (file.name.endsWith('.csv')) {
                showMessage(`Archivo seleccionado: ${file.name}`, 'info');
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const csvContent = e.target.result;
                    try {
                        const parsedData = parseCSV(csvContent);
                        if (parsedData.length > 0) {
                            displayData(parsedData);
                            showMessage('Archivo CSV procesado exitosamente.', 'success');
                        } else {
                            showMessage('El archivo CSV está vacío o no contiene datos válidos después del procesamiento.', 'error');
                            clearTable();
                        }
                    } catch (error) {
                        console.error("Error al procesar CSV:", error);
                        showMessage(`Error al procesar el archivo CSV: ${error.message}`, 'error');
                        clearTable();
                    }
                };
                
                reader.onerror = function() {
                    showMessage('Error al leer el archivo.', 'error');
                    clearTable();
                };
                
                reader.readAsText(file); // Lee el archivo como texto
            } else {
                showMessage('Por favor, selecciona un archivo con formato .csv', 'error');
                clearTable();
                csvFileInput.value = ''; // Limpiar el input si el archivo no es CSV
            }
        }

        /**
         * Muestra un mensaje en el área de mensajes.
         * @param {string} text - El texto del mensaje.
         * @param {'info'|'success'|'error'} type - El tipo de mensaje.
         */
        function showMessage(text, type = 'info') {
            messageArea.textContent = text;
            messageArea.className = `message-box ${type}`; // Restablece clases y añade la nueva
            messageArea.style.display = 'block';
        }

        /**
         * Limpia la tabla de datos.
         */
        function clearTable() {
            csvHeaderRow.innerHTML = '';
            csvBody.innerHTML = '';
            csvDataTable.style.display = 'none';
        }

        /**
         * Parsea el contenido de un archivo CSV.
         * Esta es una función BÁSICA. Necesitarás adaptarla si tu CSV tiene comillas,
         * comas dentro de los campos, o formatos de fecha/número complejos.
         * @param {string} csvText - El contenido del archivo CSV como texto.
         * @returns {Array<Object>} Un array de objetos, donde cada objeto representa una fila.
         * La primera fila del CSV se asume que son las cabeceras.
         */
        function parseCSV(csvText) {
            const lines = csvText.trim().split(/\r\n|\n/); // Divide por nueva línea (CRLF o LF)
            
            if (lines.length === 0) {
                return [];
            }

            // Asumir que la primera línea son las cabeceras
            const headers = lines[0].split(',').map(header => header.trim());
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line === "") continue; // Saltar líneas vacías

                const values = line.split(',').map(value => value.trim());
                
                // Validación básica: número de columnas coincide con cabeceras
                if (values.length !== headers.length) {
                    console.warn(`Línea ${i+1} ignorada: número de columnas (${values.length}) no coincide con cabeceras (${headers.length}). Contenido: "${line}"`);
                    // Puedes lanzar un error aquí si prefieres ser más estricto:
                    // throw new Error(`Línea ${i+1}: Inconsistencia en el número de columnas.`);
                    continue; 
                }

                const rowObject = {};
                for (let j = 0; j < headers.length; j++) {
                    let value = values[j];
                    
                    // Intenta convertir a número si es posible
                    if (!isNaN(value) && value.trim() !== "") {
                        value = Number(value);
                    }
                    // Aquí podrías añadir lógica para parsear fechas si un campo es una fecha.
                    // Ejemplo (muy básico, necesitarías saber qué columna es la fecha):
                    // if (headers[j].toLowerCase().includes('fecha') || headers[j].toLowerCase().includes('date')) {
                    //    const parsedDate = new Date(value);
                    //    if (!isNaN(parsedDate.getTime())) {
                    //        value = parsedDate; // O formatearla como string: parsedDate.toLocaleDateString();
                    //    } else {
                    //        console.warn(`Fecha inválida en línea ${i+1}, columna '${headers[j]}': ${values[j]}`);
                    //        // Podrías decidir si mantener el string original o marcarlo como inválido
                    //    }
                    // }
                    rowObject[headers[j]] = value;
                }
                data.push(rowObject);
            }
            return data;
        }

        /**
         * Muestra los datos parseados en una tabla HTML.
         * @param {Array<Object>} data - Un array de objetos parseados del CSV.
         */
        function displayData(data) {
            clearTable(); // Limpiar tabla anterior

            if (data.length === 0) {
                csvDataTable.style.display = 'none';
                return;
            }

            const headers = Object.keys(data[0]);

            // Crear cabeceras de la tabla
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                csvHeaderRow.appendChild(th);
            });

            // Crear filas de datos
            data.forEach(rowObject => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    let cellValue = rowObject[header];
                    // Formatear fechas si son objetos Date (ajusta según tu parseo)
                    if (cellValue instanceof Date) {
                        td.textContent = cellValue.toLocaleString(); // O .toLocaleDateString(), .toISOString(), etc.
                    } else if (cellValue === null || cellValue === undefined) {
                        td.textContent = ''; // Mostrar celdas vacías para null/undefined
                    } else {
                        td.textContent = cellValue;
                    }
                    tr.appendChild(td);
                });
                csvBody.appendChild(tr);
            });

            csvDataTable.style.display = 'table'; // Mostrar la tabla
        }

        // Mensaje inicial
        showMessage('Por favor, selecciona un archivo CSV o arrástralo a la zona de arriba.', 'info');

    </script>
</body>
</html>
